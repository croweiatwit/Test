<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="CSS/Gobal_Page.css" />
  <link rel="stylesheet" href="CSS/Menu_Bar.css" />
  <title>Messenger</title>

</head>
<body>


 <label for="menuToggle">
    <input type="checkbox" id="menuToggle">
    <div class="toggle">
      <span class="top_line common"></span>
      <span class="middle_line common"></span>
      <span class="bottom_line common"></span>
    </div>
  </label>

  <div class="Menu">
    <ul class="main-menu">
      <li>
                <label for="Dashboard">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                        fill="#3271a5">
                        <path
                            d="M520-600v-240h320v240H520ZM120-440v-400h320v400H120Zm400 320v-400h320v400H520Zm-400 0v-240h320v240H120Z" />
                    </svg>
                </label>

                <a href="Home_Page.html">Home</a>
            </li>
      <li>
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                    fill="#7bd05d">
                    <path
                        d="m136-240-56-56 296-298 160 160 208-206H640v-80h240v240h-80v-104L536-320 376-480 136-240Z" />
                </svg>
                <a href="Trending_Apartments_Page.html">Trending</a>
            </li>
      <li>
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                    fill="#Ff0000">
                    <path
                        d="M480-388q51-47 82.5-77.5T611-518q17-22 23-38.5t6-35.5q0-36-26-62t-62-26q-21 0-40.5 8.5T480-648q-12-15-31-23.5t-41-8.5q-36 0-62 26t-26 62q0 19 5.5 35t22.5 38q17 22 48 52.5t84 78.5ZM200-120v-640q0-33 23.5-56.5T280-840h400q33 0 56.5 23.5T760-760v640L480-240 200-120Z" />
                </svg>
                <a href="Saved_Page.html">Saved</a>

            </li>
                  <li>
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                    fill="#D2B48C">
                    <path
                        d="M80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm160-320h320v-80H240v80Zm0-120h480v-80H240v80Zm0-120h480v-80H240v80Z" />
                </svg>
                <a href="Messenger_Page.html" target="_top">Messages</a>



            </li>
      <li class="mobile-sublet-link"><a href="Sublet_Form.html">Add Sublet</a></li>
      <div class="dropdown">
        <a href="#" class="dropbtn">Explore</a>
        <div class="dropdown-content">
          <a href="Crime_Safety_Page.html">Crime / Safest Neighborhoods</a>
          <a href="Rent_Calculations.html">Rent Calculation</a>
        </div>
      </div>
      <!-- Add Sublet visible only on small screens -->
      
    <ul class="account-menu">
            
            <li>
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                    fill="#000000">
                    <path
                        d="m370-80-16-128q-13-5-24.5-12T307-235l-119 50L78-375l103-78q-1-7-1-13.5v-27q0-6.5 1-13.5L78-585l110-190 119 50q11-8 23-15t24-12l16-128h220l16 128q13 5 24.5 12t22.5 15l119-50 110 190-103 78q1 7 1 13.5v27q0 6.5-2 13.5l103 78-110 190-118-50q-11 8-23 15t-24 12L590-80H370Zm112-260q58 0 99-41t41-99q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 58 40.5 99t99.5 41Z" />
                </svg>
                <a href="Setting_Page.html">Settings</a>


            </li>
            <li>
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                    fill="#000000">
                    <path
                        d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v80h-80v-80H200v560h560v-80h80v80q0 33-23.5 56.5T760-120H200Zm480-160-56-56 103-104H360v-80h367L624-624l56-56 200 200-200 200Z" />
                </svg>
                <a href="Login_Page.html">Log Out</a>
            </li>
        </ul>
  </div>

  <!-- Top Strip -->
<div class="top-strip">
  <h2>
   <div class="main-logo" id="siteLogo"></div>



    Student APTs
  </h2>
</div>

<!-- Spacer so content below doesn't get hidden -->
<div style="height: 5px;"></div>

<hr>
<!-- 
</head> -->
<!-- <body> -->

  <div class="notification-box">
    <span class="notification-count"></span>
    <div class="notification-bell">
      <span class="bell-top"></span>
      <span class="bell-middle"></span>
      <span class="bell-bottom"></span>
      <span class="bell-rad"></span>
    </div>
  </div>

  <!-- Profile Dropdown -->
  <div class="profile-dropdown">
    <img src="Photos/Background_image.png" alt="Profile" class="profile-avatar" id="profileToggle">

    <div class="dropdown-card" id="profileMenu">
      <div class="profile-header">
        <img src="Photos/Background_image.png" alt="Avatar">
        <div>
          <div class="name" id="profileName">Loading...</div>
          <div class="email" id="profileEmail">Loading...</div>
        </div>
      </div>

<div class="theme-toggle">
          <button class="theme-btn active" data-theme="light" aria-label="Light Mode">
            <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                width="24px" fill="#e3e3e3">
                <path
                  d="M440-760v-160h80v160h-80Zm266 110-55-55 112-115 56 57-113 113Zm54 210v-80h160v80H760ZM440-40v-160h80v160h-80ZM254-652 140-763l57-56 113 113-56 54Zm508 512L651-255l54-54 114 110-57 59ZM40-440v-80h160v80H40Zm157 300-56-57 112-112 29 27 29 28-114 114Zm283-100q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm0-80q66 0 113-47t47-113q0-66-47-113t-113-47q-66 0-113 47t-47 113q0 66 47 113t113 47Zm0-160Z" />
              </svg></span>
          </button>
          <button class="theme-btn" data-theme="dark" aria-label="Dark Mode">
            <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                width="24px" fill="#00000">
                <path
                  d="M484-80q-84 0-157.5-32t-128-86.5Q144-253 112-326.5T80-484q0-146 93-257.5T410-880q-18 99 11 193.5T521-521q71 71 165.5 100T880-410q-26 144-138 237T484-80Zm0-80q88 0 163-44t118-121q-86-8-163-43.5T464-465q-61-61-97-138t-43-163q-77 43-120.5 118.5T160-484q0 135 94.5 229.5T484-160Zm-20-305Z" />
              </svg></span>
          </button>
        </div>


      <div class="menu-links">
  <a href="#" class="menu-item">
    <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#D2B48C">
      <path d="M480-440q58 0 99-41t41-99q0-58-41-99t-99-41q-58 0-99 41t-41 99q0 58 41 99t99 41ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-46q-54-53-125.5-83.5T480-360q-83 0-154.5 30.5T200-246v46Z"/></svg></span>
    <span class="label">Profile</span>
  </a>

  <a href="Saved_Page.html" class="menu-item">
    <svg class="icon" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" fill="#FF0000">
      <path d="M480-388q51-47 82.5-77.5T611-518q17-22 23-38.5t6-35.5q0-36-26-62t-62-26q-21 0-40.5 8.5T480-648q-12-15-31-23.5t-41-8.5q-36 0-62 26t-26 62q0 19 5.5 35t22.5 38q17 22 48 52.5t84 78.5ZM200-120v-640q0-33 23.5-56.5T280-840h400q33 0 56.5 23.5T760-760v640L480-240 200-120Z"/>
    </svg>
    <span class="label">Saved</span>
  </a>

  <a href="#" class="menu-item">
    <span class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#3271a5">
      <path d="M170-228q-38-45-61-99T80-440h82q6 43 22 82.5t42 73.5l-56 56ZM80-520q8-59 30-113t60-99l56 56q-26 34-42 73.5T162-520H80ZM438-82q-59-6-112.5-28.5T226-170l56-58q35 26 74 43t82 23v80ZM284-732l-58-58q47-37 101-59.5T440-878v80q-43 6-82.5 23T284-732ZM518-82v-80q44-6 83.5-22.5T676-228l58 58q-47 38-101.5 60T518-82Zm160-650q-35-26-75-43t-83-23v-80q59 6 113.5 28.5T734-790l-56 58Zm112 504-56-56q26-34 42-73.5t22-82.5h82q-8 59-30 113t-60 99Zm8-292q-6-43-22-82.5T734-676l56-56q38 45 61 99t29 113h-82ZM441-280v-247L337-423l-56-57 200-200 200 200-57 56-103-103v247h-80Z"/></svg>
    </span>
    <span class="label">Upgrade Plan</span>
  </a>

  <a href="Sublet_Form.html" class="menu-item">
    <svg class="icon" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" fill="#ff7900">
      <path d="M160-200v-80h80v-280q0-83 50-147.5T420-792v-28q0-25 17.5-42.5T480-880q25 0 42.5 17.5T540-820v28q80 20 130 84.5T720-560v280h80v80H160Z"/>
    </svg>
    <span class="label">Notifications</span>
  </a>

  <a href="Setting_Page.html" class="menu-item">
    <svg class="icon" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" fill="#808080">
      <path
                        d="m370-80-16-128q-13-5-24.5-12T307-235l-119 50L78-375l103-78q-1-7-1-13.5v-27q0-6.5 1-13.5L78-585l110-190 119 50q11-8 23-15t24-12l16-128h220l16 128q13 5 24.5 12t22.5 15l119-50 110 190-103 78q1 7 1 13.5v27q0 6.5-2 13.5l103 78-110 190-118-50q-11 8-23 15t-24 12L590-80H370Zm112-260q58 0 99-41t41-99q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 58 40.5 99t99.5 41Z" />
    </svg>
    <span class="label">Settings</span>
  </a>

  <a href="Login_Page.html" class="menu-item">
    <svg class="icon" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" fill="#bebebe">
      <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v80h-80v-80H200v560h560v-80h80v80q0 33-23.5 56.5T760-120H200Zm480-160-56-56 103-104H360v-80h367L624-624l56-56 200 200-200 200Z"/>
    </svg>
    <span class="label">Log Out</span>
  </a>
</div>

    </div>
  </div>

<style>
    
    .insta-messenger {
      display: flex;
      max-width: 85%;
      height: 80%;
      margin: 40px auto;
      border: 1px solid #ddd;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      background: #fff;
    }


    .sidebar-search {
      padding: 15px;
      border-bottom: 1px solid #eee;
    }

    .sidebar-search input {
      width: 70%;
      padding: 8px;
      border-radius: 20px;
      border: 1px solid #010101c4;
    }

    .sidebar {
      padding:15px;
      width: 25%;
      border-right: 1px solid #eee;
      display: flex;
      flex-direction: column;
      background-color: #fdfdfd;
      
    }

    .sidebar #searchInput {
      padding: 8px;
      width: 70%;
      border-radius: 12px;
}
    .sidebar-header {
      padding: 15px;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 20px;
    }

    .sidebar-header h3 {
      margin: 0;
      font-size: 1.2rem;
    }

    .sidebar-header button {
      background: none;
      border: none;
      cursor: pointer;
    }

    .sidebar-header input {
      width: 70%;
      margin: 10px auto;
      padding: 10px;
      border-radius: 20px;
      border: 1px solid #ccc;
      outline: none;
      display: block;
    }

    .chat-list {
      flex: 1;
      overflow-y: auto;
    }


    .chat {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 1px solid #f0f0f0;
      transition: background 0.2s;
    }

    .chat:hover {
      background: #f5f5f5;
    }

    .chat img {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      margin-right: 12px;
    }

    .chat-info strong {
      display: block;
      font-size: 0.95rem;
    }

    .chat-info p {
      margin: 2px 0 0;
      font-size: 12px;
      color: #888;
    }

    .message-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
      background-color: #fafafa;
    }

    .conversation {
      width: 100%;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .chat-header {
      padding: 16px;
      font-weight: bold;
      font-size: 1rem;
      border-bottom: 1px solid #eee;
    }

    .chat-body {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
    }

    .chat-input {
      display: flex;
      padding: 16px;
      border-top: 1px solid #ddd;
      background: #fff;
    }

    .chat-input input {
      flex: 1;
      padding: 10px 14px;
      border-radius: 20px;
      border: 1px solid #ccc;
      margin-right: 10px;
      font-size: 14px;
    }

    .chat-input button {
      background: #0095f6;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
    }

    .message {
      background: #e1f3ff;
      padding: 10px 14px;
      margin: 6px 0;
      border-radius: 12px;
      max-width: 75%;
      font-size: 14px;
    }

    .sent {
      align-self: flex-end;
      background: #daf8cb;
    }

    .received {
      align-self: flex-start;
      background: #f1f1f1;
    }

    .message-area .placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center; /* Optional: center vertically too */
  height: 100%;            /* Optional: stretch to parent */
  text-align: center;      /* Optional: center the text */
  }

  </style>
</head>
<body>
  <div class="insta-messenger">
    <div class="sidebar">
      <div class="sidebar-header">
        <h3>Chat</h3>
        <button>
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000">
            <path d="M120-160v-600q0-33 23.5-56.5T200-840h480q33 0 56.5 23.5T760-760v203q-10-2-20-2.5t-20-.5q-10 0-20 .5t-20 2.5v-203H200v400h283q-2 10-2.5 20t-.5 20q0 10 .5 20t2.5 20H240L120-160Zm160-440h320v-80H280v80Zm0 160h200v-80H280v80Zm400 280v-120H560v-80h120v-120h80v120h120v80H760v120h-80Z"/>
          </svg>
        </button>
      </div>
      
      <input type="text" id="searchInput" placeholder="Search users...">
    
      <div class="chat-list" id="chatList"></div>
    </div>
    <div class="message-area" id="messageArea">
      <div class="placeholder">
        <h2>Your Messages</h2>
        <p>Click a user to start chatting</p>
      </div>
    </div>
  </div>
</body>
</html>

  </style>

<!-- Footer -->

<style>
    .main {
      grid-area: main;
      padding: 10rem;
    }

    .footer {
      grid-area: footer;
      z-index: 1;
      --footer-background:var(--menu-color);
      display: grid;
      position: relative;
      min-height: 5rem;
    }

    .footer .bubbles {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1rem;
      background: var(--footer-background);
      filter: url("#blob");
    }

    .footer .bubbles .bubble {
      position: absolute;
      left: var(--position, 50%);
      background: var(--footer-background);
      border-radius: 100%;
      animation: bubble-size var(--time, 4s) ease-in infinite var(--delay, 0s),
                 bubble-move var(--time, 4s) ease-in infinite var(--delay, 0s);
      transform: translate(-50%, 100%);
    }

    .footer .content {
      z-index: 2;
      display: grid;
      grid-template-columns: 1fr auto;
      grid-gap: 2rem;
      padding: 2rem;
      background: var(--footer-background);
    }

    .footer .content a,
    .footer .content p {
      color: #F5F7FA;
      text-decoration: none;
    }

    .footer .content b {
      color: white;
    }

    .footer .content p {
      margin: 0;
      font-size: 0.75rem;
    }

    .footer .content > div {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .footer .content > div > div {
      margin: 0.25rem 0;
    }

    .footer .content > div > div > * {
      margin-right: 0.5rem;
    }

    .footer .content .image {
      align-self: center;
      width: 4rem;
      height: 4rem;
      margin: 0.25rem 0;
      background-size: cover;
      background-position: center;
    }

    @keyframes bubble-size {
      0%, 75% {
        width: var(--size, 1rem);
        height: var(--size, 2rem);
      }
      100% {
        width: 0rem;
        height: 0rem;
      }
    }

    @keyframes bubble-move {
      0% {
        bottom: -1rem;
      }
      100% {
        bottom: var(--distance, 10rem);
      }
    }
  </style>
</head>
<b>
  <main class="main">
    
  </main>

  <footer class="footer">
    <div class="bubbles" id="bubbles-container"></div>
    <div class="content">
      <div>
        <div>
          <b>Student APTs</b>
          <a href="Home_Page.html">Home</a>
          <a href="Saved_Page.html">Saved</a>
          <a href="Rent_Calculations.html">Rent Calculator</a>
          <a href="Setting_Page.html">Settings</a>
          <a href="Login_Page.html">Logout</a>
          
        </div>
        <div>
          <b>Producer</b> <br>
          <a href="#">Isabella Crowe @ WIT</a>
  
        </div>
      </div>
      <div>
        <a class="image"
           href="https://codepen.io/z-"
           target="_blank"
           style="background-image: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/199011/happy.svg');"
        ></a>

      </div>
    </div>
  </footer>

  <svg style="position: fixed; top: 100vh;">
    <defs>
      <filter id="blob">
        <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
        <feColorMatrix
          in="blur"
          mode="matrix"
          values="1 0 0 0 0  
                  0 1 0 0 0  
                  0 0 1 0 0  
                  0 0 0 19 -9"
          result="blob"
        />
      </filter>
    </defs>
  </svg>

  <script>
    const container = document.getElementById('bubbles-container');
    for (let i = 0; i < 128; i++) {
      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.style.setProperty('--size', `${2 + Math.random() * 4}rem`);
      bubble.style.setProperty('--distance', `${6 + Math.random() * 4}rem`);
      bubble.style.setProperty('--position', `${-5 + Math.random() * 110}%`);
      bubble.style.setProperty('--time', `${2 + Math.random() * 2}s`);
      bubble.style.setProperty('--delay', `${-1 * (2 + Math.random() * 2)}s`);
      container.appendChild(bubble);
    }
  </script>


<!-- <script>
  let selectedUser = null;
  let messages = JSON.parse(localStorage.getItem('messages') || '{}');
  let allUsers = [];

  const chatList = document.getElementById('chatList');
  const searchInput = document.getElementById('searchInput');
  const messageArea = document.getElementById('messageArea');

  function saveMessages() {
    localStorage.setItem('messages', JSON.stringify(messages));
  }

  function renderChatList(filteredUsers = allUsers) {
    chatList.innerHTML = '';
    if (filteredUsers.length === 0) {
      chatList.innerHTML = '<p style="padding:10px; color:gray;">No users found.</p>';
      return;
    }

    filteredUsers.forEach(user => {
      const chat = document.createElement('div');
      chat.className = 'chat';
      chat.innerHTML = `
        <img src="https://i.pravatar.cc/40?u=${user.email}" />
        <div class="chat-info">
          <strong>${user.username}</strong>
          <p>${user.email}</p>
        </div>
      `;
      chat.addEventListener('click', () => openChat(user));
      chatList.appendChild(chat);
    });
  }

  function openChat(user) {
    selectedUser = user;
    if (!messages[user.email]) messages[user.email] = [];

    const userMessages = messages[user.email];

    messageArea.innerHTML = `
      <div class="conversation">
        <div class="chat-header">Chat with ${user.username}</div>
        <div class="chat-body" id="chatBody">
          ${userMessages.map(msg => `
            <div class="message ${msg.from === 'me' ? 'sent' : 'received'}">${msg.text}</div>
          `).join('')}
        </div>
        <div class="chat-input">
          <input type="text" id="msgInput" placeholder="Type a message..." />
          <button id="sendBtn">Send</button>
        </div>
      </div>
    `;

    document.getElementById('sendBtn').addEventListener('click', sendMessage);
  }

  function sendMessage() {
    const input = document.getElementById('msgInput');
    const text = input.value.trim();
    if (!text || !selectedUser) return;

    const userEmail = selectedUser.email;
    if (!messages[userEmail]) messages[userEmail] = [];
    messages[userEmail].push({ from: 'me', text });

    const chatBody = document.getElementById('chatBody');
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message sent';
    msgDiv.textContent = text;
    chatBody.appendChild(msgDiv);

    input.value = '';
    chatBody.scrollTop = chatBody.scrollHeight;
    saveMessages();
  }

  // üîç Search filtering
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase();
    const filtered = allUsers.filter(user =>
      user.username?.toLowerCase().includes(query) ||
      user.email?.toLowerCase().includes(query)
    );

    console.log("Search query:", query);
    console.log("Matching usernames:", filtered.map(u => u.username));

    renderChatList(filtered);
  });

// üîÅ Fetch users from backend API
fetch('/api/users')
  .then(res => {
    console.log('[DEBUG] Response status:', res.status);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json();
  })
  .then(users => {
    console.log('[DEBUG] Fetched users:', users);
    allUsers = users;
    renderChatList();
  })
  .catch(err => {
    console.error('[ERROR] Failed to load users:', err);
    chatList.innerHTML = '<p style="padding:10px; color:red;">‚ö†Ô∏è Unable to load user list. Check server.</p>';
  });

</script> -->

<script>
  let selectedUser = null;
  let messages = JSON.parse(localStorage.getItem('messages') || '{}');
  let allUsers = [];

  const chatList = document.getElementById('chatList');
  const searchInput = document.getElementById('searchInput');
  const messageArea = document.getElementById('messageArea');

  function saveMessages() {
    localStorage.setItem('messages', JSON.stringify(messages));
  }

  function renderChatList(filteredUsers = allUsers) {
    chatList.innerHTML = '';
    if (filteredUsers.length === 0) {
      chatList.innerHTML = '<p style="padding:10px; color:gray;">No users found.</p>';
      return;
    }

    filteredUsers.forEach(user => {
      const chat = document.createElement('div');
      chat.className = 'chat';
      chat.innerHTML = `
        <img src="https://i.pravatar.cc/40?u=${user.email}" />
        <div class="chat-info">
          <strong>${user.username}</strong>
          <p>${user.email}</p>
        </div>
      `;
      chat.addEventListener('click', () => openChat(user));
      chatList.appendChild(chat);
    });
  }

  function openChat(user) {
    selectedUser = user;
    if (!messages[user.email]) messages[user.email] = [];

    const userMessages = messages[user.email];

    messageArea.innerHTML = `
      <div class="conversation">
        <div class="chat-header">Chat with ${user.username}</div>
        <div class="chat-body" id="chatBody">
          ${userMessages.map(msg => `
            <div class="message ${msg.from === 'me' ? 'sent' : 'received'}">${msg.text}</div>
          `).join('')}
        </div>
        <div class="chat-input">
          <input type="text" id="msgInput" placeholder="Type a message..." />
          <button id="sendBtn">Send</button>
        </div>
      </div>
    `;

    document.getElementById('sendBtn').addEventListener('click', sendMessage);
  }

  function sendMessage() {
    const input = document.getElementById('msgInput');
    const text = input.value.trim();
    if (!text || !selectedUser) return;

    const userEmail = selectedUser.email;
    if (!messages[userEmail]) messages[userEmail] = [];
    messages[userEmail].push({ from: 'me', text });

    const chatBody = document.getElementById('chatBody');
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message sent';
    msgDiv.textContent = text;
    chatBody.appendChild(msgDiv);

    input.value = '';
    chatBody.scrollTop = chatBody.scrollHeight;
    saveMessages();
  }

  // üîç Search filtering (results only shown after input)
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase().trim();

    if (!query) {
      chatList.innerHTML = ''; // hide chat list if nothing typed
      return;
    }

    const filtered = allUsers.filter(user =>
      user.username?.toLowerCase().includes(query) ||
      user.email?.toLowerCase().includes(query)
    );

    console.log("Search query:", query);
    console.log("Matching usernames:", filtered.map(u => u.username));

    renderChatList(filtered);
  });

  // üîÅ Fetch users from user.json (background load, no render on load)
fetch('/api/users')
    .then(res => {
      console.log('[DEBUG] Response status:', res.status);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    })
    .then(users => {
      console.log('[DEBUG] Fetched users:', users);
      allUsers = users;
      // üö´ Do NOT call renderChatList here ‚Äî wait for search input
    })
    .catch(err => {
      console.error('[ERROR] Failed to load users:', err);
      chatList.innerHTML = '<p style="padding:10px; color:red;">‚ö†Ô∏è Unable to load user list. Check server.</p>';
    });
</script>






    <script>
      // Menu Toggle
      document.addEventListener("DOMContentLoaded", function () {
        const menuToggle = document.getElementById("menuToggle");
        const menu = document.querySelector(".Menu");
        const body = document.body;

        menuToggle.addEventListener("change", function () {
          if (menuToggle.checked) {
            menu.style.transform = "translateX(0)";
            body.classList.add("menu-open");
          } else {
            menu.style.transform = "translateX(-300px)";
            body.classList.remove("menu-open");
          }
        });

        // Load user info from localStorage
        const userData = localStorage.getItem("user");
        if (userData) {
          const user = JSON.parse(userData);
          if (user.fullName) document.getElementById("profileName").textContent = user.fullName;
          if (user.email) document.getElementById("profileEmail").textContent = user.email;
        }
      });
    </script>

    <script>
      // Profile Dropdown
      const toggle = document.getElementById("profileToggle");
      const profileMenu = document.getElementById("profileMenu");

      toggle.addEventListener("click", () => {
        profileMenu.style.display = profileMenu.style.display === "block" ? "none" : "block";
      });

      window.addEventListener("click", (e) => {
        if (!toggle.contains(e.target) && !profileMenu.contains(e.target)) {
          profileMenu.style.display = "none";
        }
      });
    </script>

    <script>
      // Theme Toggle
      document.addEventListener('DOMContentLoaded', () => {
        const themeButtons = document.querySelectorAll('.theme-btn');
        const savedTheme = localStorage.getItem('theme');

        if (savedTheme === 'dark') {
          document.body.classList.add('dark-mode');
          setLogo(true);
          setActiveTheme('dark');
        }

        themeButtons.forEach(button => {
          button.addEventListener('click', () => {
            const theme = button.dataset.theme;
            document.body.classList.toggle('dark-mode', theme === 'dark');
            localStorage.setItem('theme', theme);
            setLogo(theme === 'dark');
            setActiveTheme(theme);
          });
        });

        function setActiveTheme(theme) {
          themeButtons.forEach(btn => {
            btn.classList.toggle('active', btn.dataset.theme === theme);
          });
        }

        function setLogo(isDark) {
          const logo = document.getElementById('siteLogo');
          logo.style.backgroundImage = isDark
            ? "url('Photos/Boston_Logo_White.png')"
            : "url('Photos/Boston_Logo.png')";
        }
      });
    </script>

    <script>
      // Notification Bell
      document.addEventListener('DOMContentLoaded', () => {
        const notificationCount = 0; // Set dynamic value here
        const bell = document.querySelector('.notification-bell');
        const countEl = document.querySelector('.notification-count');

        if (notificationCount > 0) {
          bell.classList.add('animate-bell');
          countEl.textContent = notificationCount;
          countEl.style.display = 'block';
        } else {
          bell.classList.remove('animate-bell');
          countEl.textContent = '';
          countEl.style.display = 'none';
        }
      });
    </script>
</html>
</body>
</html>
